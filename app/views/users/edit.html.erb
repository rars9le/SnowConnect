<% provide :title, 'プロフィール編集' %>

<div class="container user_form mt-3">
  <%= render "shared/error_messages" %>

  <h2 class="form_title">プロフィール編集</h2>

    <%= form_for @user do |f| %>

    <div class="text-center mb-3">
      <%= f.label :avator do %>
        <img id="avator_img_prev" src="#" class='hidden rounded-circle z-depth-0 mb-4' style="width: 200px; height: 200px; object-fit: cover; cursor: pointer;" alt="avator image"/>
        <%= f.file_field :avator %>
        <% if @user.avator? %>
          <%= f.label :avator do %>
            <%= image_tag(@user.avator.url, size: "200x200", class: "avator_present_img rounded-circle z-depth-0 avator-image", alt: "avator image") %>
          <% end %>
        <% else %>
          <%= f.label :avator do %>
            <%= image_tag("default.png", size: "200x200", class: "avator_present_img rounded-circle z-depth-0 avator-image", alt: "avator image") %>
          <% end %>
        <% end %>
      <% end %>
    </div>

      <div class="form-group">
        <%= f.label :name, '名前' %>
        <%= f.text_field :name, class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= f.label :introduction, '自己紹介' %>
        <%= f.text_area :introduction, class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= f.label :email, 'メールアドレス' %>
        <%= f.email_field :email, class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= f.label :password, 'パスワード' %>
        <%= f.password_field :password, class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= f.label :password_confirmation, 'パスワード(再入力)' %>
        <%= f.password_field :password_confirmation, class: 'form-control' %>
      </div>
      
      <div class="d-flex justify-content-center">
        <%= link_to '戻る', user_path(@user.id), class: 'btn btn-secondary mr-4' %>
        <%= f.submit '更新', class: 'btn btn-secondary ' %>
      </div>      
      
    <% end %>
  </div>
</div>

<script type="text/javascript">
  $(function() {
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $('#avator_img_prev').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }

    $("#user_avator").change(function(){
      $('#avator_img_prev').removeClass('hidden');
      $('.avator_present_img').remove();
      readURL(this);
    });
  });
</script>